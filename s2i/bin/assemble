#!/bin/bash -e

set -e

echo "---> Installing application source..."
cp -Rf /tmp/src/. ./

pomfile=pom.xml
gradlefile=build.gradle

if [ -f $pomfile ]; then
   echo "---> Maven build detected..."
   mvn clean install -Dmaven.repo.local=/tmp/artifacts/m2 -DskipTests -Dfabric8.skip=true -Djava.net.preferIPv4Stack=true
   echo "---> Moving the jar file(s) to the application directory..."
   mv ./target/*.jar ./
elif [ -f $gradlefile ]; then
    echo "---> Gradle build detected..."
    gradle build
    echo "---> Moving the jar file(s) to the application directory..."
    mv ./build/libs/*.jar ./
fi